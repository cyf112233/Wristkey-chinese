name: Decode and Upload Keystore

on:
  workflow_dispatch:
  push:
    branches: [ main, master ]
    tags:
      - 'v*'

permissions:
  contents: read

jobs:
  decode-and-upload-keystore:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Create keystore directory
        run: mkdir -p keystore
        
      - name: Decode Keystore using base64 command
        run: |
          echo "${{ secrets.KEYSTORE }}" | base64 -d > keystore/your_signing_keystore.jks
          
      - name: Verify keystore file
        run: |
          if [ -f "keystore/your_signing_keystore.jks" ] && [ -s "keystore/your_signing_keystore.jks" ]; then
            echo "âœ… Keystore file created successfully"
            echo "ğŸ“ File size: $(wc -c < keystore/your_signing_keystore.jks) bytes"
          else
            echo "âŒ Error: Keystore file is empty or not found"
            exit 1
          fi
          
      - name: Upload Keystore as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: signing-keystore
          path: keystore/your_signing_keystore.jks
          retention-days: 1
          
      - name: Clean up sensitive file
        run: |
          # å¯é€‰çš„æ¸…ç†æ­¥éª¤ï¼Œå¢å¼ºå®‰å…¨æ€§
          rm -f keystore/your_signing_keystore.jks
          echo "ğŸ§¹ Keystore file cleaned up from runner"
